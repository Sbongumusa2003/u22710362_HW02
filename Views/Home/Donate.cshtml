@model u22710362_HW2.Models.PetRecordsVM
@{
    ViewBag.Title = "Support Our Cause";
    Layout = "~/Views/Shared/_Layout.cshtml";
    decimal progressPercentage = Model.DonationGoal > 0 ? (Model.TotalDonations / Model.DonationGoal) * 100 : 0;
    bool goalReached = Model.TotalDonations >= Model.DonationGoal;
}

<div class="container mt-4">
    <div class="text-center mb-4">
        <h1>Support Our Mission</h1>
        <p class="lead text-muted">Help us save more lives by supporting our rescue efforts</p>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header @(goalReached ? "bg-success" : "bg-warning") text-white text-center">
                    <h4 class="mb-0">
                        @(goalReached ? "Goal Achieved!" : "Fundraising Progress")
                    </h4>
                </div>
                <div class="card-body text-center">
                    @if (goalReached)
                    {
                        <div class="alert alert-success">
                            <h3>🎉 Amazing! We've reached our goal!</h3>
                            <p class="mb-0">Thanks to generous supporters like you, we've exceeded our fundraising target!</p>
                        </div>
                    }

                    <div class="mb-4">
                        <h2 class="text-primary display-6">R @Model.TotalDonations.ToString("N2")</h2>
                        <p class="text-muted">raised of R @Model.DonationGoal.ToString("N2") goal</p>
                    </div>
                    <div class="progress mb-4" style="height: 25px;">
                        <div class="progress-bar @(goalReached ? "bg-success" : "bg-primary") @(goalReached ? "" : "progress-bar-striped progress-bar-animated")"
                             role="progressbar"
                             style="width: @Math.Min(progressPercentage, 100)%;"
                             aria-valuenow="@progressPercentage"
                             aria-valuemin="0"
                             aria-valuemax="100">
                            @progressPercentage.ToString("F1")%
                        </div>
                    </div>

                    @if (!goalReached)
                    {
                        <p class="lead">
                            Only R @((Model.DonationGoal - Model.TotalDonations).ToString("N2")) more to reach our goal!
                        </p>
                    }

                    <div class="row text-center mt-4">
                        <div class="col-4">
                            <div class="impact-stat p-2">
                                <h6>🏠</h6>
                                <h6>Shelter</h6>
                                <small class="text-muted">Safe housing</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="impact-stat p-2">
                                <h6>🏥</h6>
                                <h6>Medical Care</h6>
                                <small class="text-muted">Health checkups</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="impact-stat p-2">
                                <h6>🍽️</h6>
                                <h6>Nutrition</h6>
                                <small class="text-muted">Quality food</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white text-center">
                    <h4 class="mb-0">Make a Donation</h4>
                </div>
                <div class="card-body">
                    @if (goalReached)
                    {
                        <div class="alert alert-info">
                            <strong>Goal Reached!</strong> Your continued support helps us extend our impact and save even more lives!
                        </div>
                    }

                    @using (Html.BeginForm("MakeDonation", "Home", FormMethod.Post))
                    {
                        <div class="form-group mb-3">
                            <label for="userId" class="form-label">
                                <strong>Your Full Name *</strong>
                            </label>
                            <select name="userId" id="userId" class="form-control" required onchange="updateDonorPhone()">
                                <option value="">Select your name...</option>
                                @if (Model.Users != null)
                                {
                                    foreach (var user in Model.Users)
                                    {
                                        <option value="@user.ID" data-phone="@user.PhoneNumber">@user.FullName</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="donorPhone" class="form-label">
                                <strong>Phone Number</strong>
                            </label>
                            <input type="text" id="donorPhone" class="form-control" readonly placeholder="Auto-filled based on selected name">
                            <small class="form-text text-muted">Used for donation receipt and updates</small>
                        </div>

                        <div class="form-group mb-3">
                            <label for="amount" class="form-label">
                                <strong>Donation Amount (R) *</strong>
                            </label>
                            <input type="number" name="amount" id="amount" class="form-control" required min="1" max="50000" step="0.01" placeholder="0.00">
                            <div class="mt-2">
                                <small class="form-text text-muted d-block mb-2">Suggested amounts:</small>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary" onclick="setAmount(50)">R50</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="setAmount(100)">R100</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="setAmount(250)">R250</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="setAmount(500)">R500</button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-info">Your Impact</h6>
                                    <div id="impactMessage" class="text-muted">
                                        <small>Select an amount to see the impact of your donation</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-lg btn-block mb-3" onclick="return confirmDonation()">
                                Donate Now
                            </button>
                            <small class="form-text text-muted">
                                Your donation helps us continue our mission to rescue and rehome pets in need.
                            </small>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-center py-4 text-white">
                    <h2>Thank You for Your Support!</h2>
                    <p class="lead">Every donation, no matter the size, makes a real difference in the lives of animals waiting for their forever homes.</p>
                    <div class="row mt-3">
                        <div class="col-md-4 mb-3">
                            <h6>🛡️ Safe & Secure</h6>
                            <small>Your donation is processed securely</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h6>🧾 Tax Deductible</h6>
                            <small>Receipts provided for all donations</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h6>🐾 Direct Impact</h6>
                            <small>100% goes towards pet care</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        function updateDonorPhone() {
            var userSelect = document.getElementById('userId');
            var phoneInput = document.getElementById('donorPhone');
            var selectedOption = userSelect.options[userSelect.selectedIndex];

            if (selectedOption.value) {
                phoneInput.value = selectedOption.getAttribute('data-phone');
            } else {
                phoneInput.value = '';
            }
        }

        function setAmount(amount) {
            document.getElementById('amount').value = amount;
            updateImpactMessage(amount);
        }

        function updateImpactMessage(amount) {
            var impactDiv = document.getElementById('impactMessage');
            var message = '';

            if (amount >= 500) {
                message = '<strong>Amazing!</strong> This can provide comprehensive care for a pet for a month!';
            } else if (amount >= 250) {
                message = '<strong>Wonderful!</strong> This can cover medical care for a rescued pet!';
            } else if (amount >= 100) {
                message = '<strong>Great!</strong> This can provide food for a pet for two weeks!';
            } else if (amount >= 50) {
                message = '<strong>Helpful!</strong> This can provide shelter for a pet for several days!';
            } else if (amount > 0) {
                message = '<strong>Thank you!</strong> Every donation helps make a difference!';
            } else {
                message = '<small class="text-muted">Select an amount to see the impact of your donation</small>';
            }

            impactDiv.innerHTML = message;
        }

        function confirmDonation() {
            var userSelect = document.getElementById('userId');
            var amountInput = document.getElementById('amount');

            if (!userSelect.value) {
                alert('Please select your name before making a donation.');
                return false;
            }

            if (!amountInput.value || parseFloat(amountInput.value) <= 0) {
                alert('Please enter a valid donation amount.');
                return false;
            }

            return confirm('Thank you for your generosity! Are you sure you want to donate R' + parseFloat(amountInput.value).toFixed(2) + '?');
        }

        document.getElementById('amount').addEventListener('input', function () {
            var amount = parseFloat(this.value) || 0;
            updateImpactMessage(amount);
        });
    </script>
}

<style>
    .card {
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .impact-stat {
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 15px;
    }

    .progress {
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        border-radius: 10px;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-label {
        font-weight: 500;
    }

    .btn-block {
        width: 100%;
    }

    .display-6 {
        font-size: 2.5rem;
        font-weight: 600;
    }
</style>