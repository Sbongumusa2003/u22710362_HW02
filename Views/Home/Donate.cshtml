@model u22710362_HW2.Models.PetRecordsVM
@{
    ViewBag.Title = "Support Our Cause";
    Layout = "~/Views/Shared/_Layout.cshtml";
    decimal progressPercentage = Model.DonationGoal > 0 ? (Model.TotalDonations / Model.DonationGoal) * 100 : 0;
    bool goalReached = Model.TotalDonations >= Model.DonationGoal;
}

<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center py-4" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 15px;">
                <h1 class="display-4">💝 Support Our Mission</h1>
                <p class="lead">Help us save more lives by supporting our rescue efforts</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Donation Progress -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm border-0" style="border-radius: 15px;">
                <div class="card-header @(goalReached ? "bg-success" : "bg-warning") text-white text-center" style="border-radius: 15px 15px 0 0;">
                    <h4 class="mb-0">
                        <i class="fas fa-@(goalReached ? "trophy" : "target")"></i>
                        @(goalReached ? "Goal Achieved!" : "Fundraising Progress")
                    </h4>
                </div>
                <div class="card-body text-center">
                    @if (goalReached)
                    {
                        <div class="alert alert-success" role="alert">
                            <i class="fas fa-check-circle fa-3x mb-3"></i>
                            <h3>🎉 Amazing! We've reached our goal!</h3>
                            <p class="mb-0">Thanks to generous supporters like you, we've exceeded our fundraising target!</p>
                        </div>
                    }

                    <div class="mb-4">
                        <h2 class="text-primary display-6">R @Model.TotalDonations.ToString("N2")</h2>
                        <p class="text-muted">raised of R @Model.DonationGoal.ToString("N2") goal</p>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress mb-4" style="height: 25px; border-radius: 15px;">
                        <div class="progress-bar @(goalReached ? "bg-success" : "bg-primary") progress-bar-striped @(goalReached ? "" : "progress-bar-animated")"
                             role="progressbar"
                             style="width: @Math.Min(progressPercentage, 100)%; border-radius: 15px;"
                             aria-valuenow="@progressPercentage"
                             aria-valuemin="0"
                             aria-valuemax="100">
                            @progressPercentage.ToString("F1")%
                        </div>
                    </div>

                    @if (goalReached)
                    {
                        <div class="celebration-animation mb-4">
                            <p class="lead text-success font-weight-bold">
                                <i class="fas fa-heart text-danger"></i>
                                Every donation helps us save more lives!
                                <i class="fas fa-heart text-danger"></i>
                            </p>
                        </div>
                    }
                    else
                    {
                        <p class="lead">
                            Only R @((Model.DonationGoal - Model.TotalDonations).ToString("N2")) more to reach our goal!
                        </p>
                    }

                    <!-- Impact Statement -->
                    <div class="row text-center mt-4">
                        <div class="col-4">
                            <div class="impact-stat">
                                <i class="fas fa-home fa-2x text-primary mb-2"></i>
                                <h5>Shelter</h5>
                                <small class="text-muted">Safe housing for pets</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="impact-stat">
                                <i class="fas fa-stethoscope fa-2x text-success mb-2"></i>
                                <h5>Medical Care</h5>
                                <small class="text-muted">Health checkups & treatment</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="impact-stat">
                                <i class="fas fa-utensils fa-2x text-warning mb-2"></i>
                                <h5>Nutrition</h5>
                                <small class="text-muted">Quality food & care</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Donation Form -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm border-0" style="border-radius: 15px;">
                <div class="card-header bg-primary text-white text-center" style="border-radius: 15px 15px 0 0;">
                    <h4 class="mb-0"><i class="fas fa-hand-holding-heart"></i> Make a Donation</h4>
                </div>
                <div class="card-body">
                    @if (goalReached)
                    {
                        <div class="alert alert-info" role="alert">
                            <i class="fas fa-info-circle"></i>
                            <strong>Goal Reached!</strong> Your continued support helps us extend our impact and save even more lives!
                        </div>
                    }

                    @using (Html.BeginForm("MakeDonation", "Home", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
                    {
                        <div class="mb-4">
                            <label for="userId" class="form-label">
                                <i class="fas fa-user"></i> Your Full Name <span class="text-danger">*</span>
                            </label>
                            <select name="userId" id="userId" class="form-select" required onchange="updateDonorPhone()">
                                <option value="">Select your name...</option>
                                @if (Model.Users != null)
                                {
                                    foreach (var user in Model.Users)
                                    {
                                        <option value="@user.ID" data-phone="@user.PhoneNumber">@user.FullName</option>
                                    }
                                }
                            </select>
                            <div class="invalid-feedback">Please select your name from the list.</div>
                        </div>

                        <div class="mb-4">
                            <label for="donorPhone" class="form-label">
                                <i class="fas fa-phone"></i> Phone Number
                            </label>
                            <input type="text" id="donorPhone" class="form-control" readonly placeholder="Auto-filled based on selected name">
                            <small class="form-text text-muted">Used for donation receipt and updates</small>
                        </div>

                        <div class="mb-4">
                            <label for="amount" class="form-label">
                                <i class="fas fa-money-bill-wave"></i> Donation Amount (R) <span class="text-danger">*</span>
                            </label>
                            <input type="number" name="amount" id="amount" class="form-control" required min="1" max="50000" step="0.01" placeholder="0.00">
                            <div class="invalid-feedback">Please enter a valid donation amount (minimum R1.00).</div>

                            <!-- Suggested Amounts -->
                            <div class="mt-3">
                                <small class="form-text text-muted d-block mb-2">Suggested amounts:</small>
                                <div class="btn-group" role="group" aria-label="Suggested donation amounts">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="setAmount(50)">R50</button>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="setAmount(100)">R100</button>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="setAmount(250)">R250</button>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="setAmount(500)">R500</button>
                                </div>
                            </div>
                        </div>

                        <!-- Donation Impact -->
                        <div class="mb-4">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-info">Your Impact</h6>
                                    <div id="impactMessage" class="text-muted">
                                        <small>Select an amount to see the impact of your donation</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-lg w-100 py-3" style="border-radius: 50px; font-weight: bold;" onclick="return confirmDonation()">
                                <i class="fas fa-heart"></i> Donate Now
                            </button>
                            <small class="form-text text-muted mt-2">
                                Your donation helps us continue our mission to rescue and rehome pets in need.
                            </small>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Thank You Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 shadow-sm" style="border-radius: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-center py-5 text-white">
                    <i class="fas fa-heart fa-3x mb-3"></i>
                    <h2>Thank You for Your Support!</h2>
                    <p class="lead">Every donation, no matter the size, makes a real difference in the lives of animals waiting for their forever homes.</p>
                    <div class="row mt-4">
                        <div class="col-md-4 mb-3">
                            <i class="fas fa-shield-alt fa-2x mb-2"></i>
                            <h5>Safe & Secure</h5>
                            <small>Your donation is processed securely</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <i class="fas fa-receipt fa-2x mb-2"></i>
                            <h5>Tax Deductible</h5>
                            <small>Receipts provided for all donations</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <i class="fas fa-paw fa-2x mb-2"></i>
                            <h5>Direct Impact</h5>
                            <small>100% goes towards pet care</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    <script>
        function updateDonorPhone() {
            var userSelect = document.getElementById('userId');
            var phoneInput = document.getElementById('donorPhone');
            var selectedOption = userSelect.options[userSelect.selectedIndex];

            if (selectedOption.value) {
                phoneInput.value = selectedOption.getAttribute('data-phone');
            } else {
                phoneInput.value = '';
            }
        }

        function setAmount(amount) {
            document.getElementById('amount').value = amount;
            updateImpactMessage(amount);
        }

        function updateImpactMessage(amount) {
            var impactDiv = document.getElementById('impactMessage');
            var message = '';

            if (amount >= 500) {
                message = '<i class="fas fa-star text-warning"></i> <strong>Amazing!</strong> This can provide comprehensive care for a pet for a month!';
            } else if (amount >= 250) {
                message = '<i class="fas fa-heart text-danger"></i> <strong>Wonderful!</strong> This can cover medical care for a rescued pet!';
            } else if (amount >= 100) {
                message = '<i class="fas fa-paw text-primary"></i> <strong>Great!</strong> This can provide food for a pet for two weeks!';
            } else if (amount >= 50) {
                message = '<i class="fas fa-home text-success"></i> <strong>Helpful!</strong> This can provide shelter for a pet for several days!';
            } else if (amount > 0) {
                message = '<i class="fas fa-heart text-info"></i> <strong>Thank you!</strong> Every donation helps make a difference!';
            } else {
                message = '<small class="text-muted">Select an amount to see the impact of your donation</small>';
            }

            impactDiv.innerHTML = message;
        }

        function confirmDonation() {
            var userSelect = document.getElementById('userId');
            var amountInput = document.getElementById('amount');

            if (!userSelect.value) {
                alert('Please select your name before making a donation.');
                return false;
            }

            if (!amountInput.value || parseFloat(amountInput.value) <= 0) {
                alert('Please enter a valid donation amount.');
                return false;
            }

            return confirm('Thank you for your generosity! Are you sure you want to donate R' + parseFloat(amountInput.value).toFixed(2) + '?');
        }

        // Update impact message when amount changes
        document.getElementById('amount').addEventListener('input', function() {
            var amount = parseFloat(this.value) || 0;
            updateImpactMessage(amount);
        });

        // Bootstrap form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        // Celebration animation for goal reached
        @if (goalReached)
        {
            <text>
            document.addEventListener('DOMContentLoaded', function() {
                // Add some celebration styling
                setInterval(function() {
                    const hearts = document.querySelectorAll('.celebration-animation .fa-heart');
                    hearts.forEach(heart => {
                        heart.style.color = heart.style.color === 'red' ? '#ff69b4' : 'red';
                    });
                }, 1000);
            });
            </text>
        }
    </script>

    <style>
        .impact-stat {
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }

        .celebration-animation {
            animation: pulse 2s infinite;
        }

        keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .progress {
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        .card {
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn {
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }
    </style>
}