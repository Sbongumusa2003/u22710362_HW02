@model u22710362_HW2.Models.PetRecordsVM
@{
    ViewBag.Title = "Post a Pet for Adoption";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container mt-3">
    <div class="text-center mb-3">
        <h1>Post a Pet for Adoption</h1>
        <p class="lead text-muted">Help a pet find their perfect forever home</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Pet Information Form</h4>
                </div>
                <div class="card-body">
                    @using (Html.BeginForm("CreatePet", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        <div class="section-header mb-2">
                            <h5 class="text-primary border-bottom pb-1">Your Details</h5>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="postedByUserId" class="form-label">
                                        <strong>Your Full Name *</strong>
                                    </label>
                                    <select name="postedByUserId" id="postedByUserId" class="form-control" required onchange="updateUserPhone()">
                                        <option value="">Select your name...</option>
                                        @if (Model.Users != null)
                                        {
                                            foreach (var user in Model.Users)
                                            {
                                                <option value="@user.ID" data-phone="@user.PhoneNumber">@user.FullName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="userPhoneNumber" class="form-label">
                                        <strong>Phone Number</strong>
                                    </label>
                                    <input type="text" id="userPhoneNumber" class="form-control" readonly placeholder="Auto-filled">
                                    <small class="form-text text-muted">Auto-filled based on name</small>
                                </div>
                            </div>
                        </div>
                        <div class="section-header mb-2">
                            <h5 class="text-primary border-bottom pb-1">Pet Details</h5>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="name" class="form-label">
                                        <strong>Pet Name *</strong>
                                    </label>
                                    <input type="text" name="name" id="name" class="form-control" required placeholder="Pet's name">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="petTypeId" class="form-label">
                                        <strong>Pet Type *</strong>
                                    </label>
                                    <select name="petTypeId" id="petTypeId" class="form-control" required>
                                        <option value="">Select type...</option>
                                        @if (Model.PetTypes != null)
                                        {
                                            foreach (var type in Model.PetTypes)
                                            {
                                                <option value="@type.ID">@type.TypeName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="breedId" class="form-label">
                                        <strong>Breed *</strong>
                                    </label>
                                    <select name="breedId" id="breedId" class="form-control" required>
                                        <option value="">Select breed...</option>
                                        @if (Model.PetBreeds != null)
                                        {
                                            foreach (var breed in Model.PetBreeds)
                                            {
                                                <option value="@breed.ID">@breed.BreedName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="locationId" class="form-label">
                                        <strong>Location *</strong>
                                    </label>
                                    <select name="locationId" id="locationId" class="form-control" required>
                                        <option value="">Select location...</option>
                                        @if (Model.Locations != null)
                                        {
                                            foreach (var location in Model.Locations)
                                            {
                                                <option value="@location.ID">@location.LocationName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="age" class="form-label">
                                        <strong>Age (years) *</strong>
                                    </label>
                                    <input type="number" name="age" id="age" class="form-control" required min="0" max="30" placeholder="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="weight" class="form-label">
                                        <strong>Weight (kg) *</strong>
                                    </label>
                                    <input type="number" name="weight" id="weight" class="form-control" required min="0.1" max="200" step="0.1" placeholder="0.0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="gender" class="form-label">
                                        <strong>Gender *</strong>
                                    </label>
                                    <select name="gender" id="gender" class="form-control" required>
                                        <option value="">Select gender...</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="petStory" class="form-label">
                                        <strong>Pet Story *</strong>
                                    </label>
                                    <textarea name="petStory" id="petStory" class="form-control" rows="3" required placeholder="Tell us about this pet's personality, habits, and why they're looking for a new home..."></textarea>
                                    <small class="form-text text-muted">Share what makes this pet special.</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="petImage" class="form-label">
                                        <strong>Pet Photo *</strong>
                                    </label>
                                    <input type="file" id="petImage" class="form-control" accept="image/*" required onchange="previewImage(this)">
                                    <input type="hidden" name="b64Image" id="b64Image">
                                    <small class="form-text text-muted">Upload a clear photo (JPG, PNG, GIF).</small>
                                    <div id="imagePreview" class="mt-2" style="display: none;">
                                        <div class="text-center">
                                            <img id="previewImg" src="#" alt="Pet Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                                            <p class="mt-1 text-muted">Image preview</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <div class="card border-success mb-2">
                                <div class="card-body">
                                    <h5 class="card-title text-success">Ready to Post?</h5>
                                    <p class="card-text">By posting, you're helping this pet find a loving forever home.</p>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success btn-lg me-2">Post Pet</button>
                            @Html.ActionLink("Cancel", "Pets", "Home", null, new { @class = "btn btn-outline-secondary btn-lg" })
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script>
        function updateUserPhone() {
            var userSelect = document.getElementById('postedByUserId');
            var phoneInput = document.getElementById('userPhoneNumber');
            var selectedOption = userSelect.options[userSelect.selectedIndex];

            if (selectedOption.value) {
                phoneInput.value = selectedOption.getAttribute('data-phone');
            } else {
                phoneInput.value = '';
            }
        }

        function filterPetBreeds() {
            var selectedTypeId = document.getElementById('petTypeId').value;
            var breedSelect = document.getElementById('breedId');
            var options = breedSelect.options;
            // Reset breed selection
            breedSelect.value = '';
            for (var i = 1; i < options.length; i++) {
                var option = options[i];
                var breedPetTypeId = option.getAttribute('data-pettype');

                if (selectedTypeId === '' || breedPetTypeId === selectedTypeId) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            }
        }
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var preview = document.getElementById('previewImg');
                    var previewDiv = document.getElementById('imagePreview');
                    var b64Input = document.getElementById('b64Image');
                    preview.src = e.target.result;
                    previewDiv.style.display = 'block';
                    var base64String = e.target.result.split(',')[1];
                    b64Input.value = base64String;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}
<style>
    .section-header h5 {
        font-weight: 600;
    }

    .form-label {
        font-weight: 500;
        color: #495057;
    }

    .card {
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-group {
        margin-bottom: 0.75rem;
    }

    .form-control, .btn {
        font-size: 0.9rem;
    }
</style>